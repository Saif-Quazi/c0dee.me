<!doctype html>
<html>
<head>
<meta charset="utf-8" />
<title>Browser</title>
<style>
  body { margin:0; background:#000; }
  canvas { display:block; }
</style>
</head>
<body>

<canvas id="c" width="1280" height="720"></canvas>

<script>
const ACCESS_KEY = "changeme";
const c = document.getElementById("c");
const ctx = c.getContext("2d");

function pull() {
  const img = new Image();
  img.onload = () => {
    ctx.drawImage(img, 0, 0);
    requestAnimationFrame(pull);
  };
  img.src = "/frame?t=" + Date.now();
}
pull();

function send(data) {
  fetch("/input", {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      "X-Access-Key": ACCESS_KEY
    },
    body: JSON.stringify(data)
  });
}

c.onmousemove = e =>
  send({ t:"mm", x:e.offsetX, y:e.offsetY });

c.onmousedown = () =>
  send({ t:"md" });

c.onmouseup = () =>
  send({ t:"mu" });

document.onkeydown = e =>
  send({ t:"kd", k:e.key });

document.onkeyup = e =>
  send({ t:"ku", k:e.key });
</script>

</body>
</html>
